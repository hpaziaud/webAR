<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP02 WebAR - Exercice 3 : Interactions par clic/tap</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        embedded 
        arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
        
        <!-- Marqueur Hiro avec boîte interactive -->
        <a-marker preset="hiro" raycaster="objects: .clickable" emitevents="true">
            <a-box 
                id="interactiveBox"
                position="0 0.5 0" 
                material="color: #4CC3D9; opacity: 0.8; transparent: true;" 
                animation="property: rotation; to: 0 360 0; loop: true; dur: 2000;"
                class="clickable"
                geometry="primitive: box; width: 1; height: 1; depth: 1;"
                scale="1 1 1">
            </a-box>
        </a-marker>
        
        <!-- Caméra AR avec curseur -->
        <a-entity camera>
            <a-cursor 
                id="cursor"
                raycaster="objects: .clickable"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat"
                animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                animation__mouseleave="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 150"
                position="0 0 -1"
                cursor="fuse: true; fuseTimeout: 1500">
            </a-cursor>
        </a-entity>
    </a-scene>

    <!-- Instructions pour l'utilisateur -->
    <div style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 15px; border-radius: 5px; font-family: Arial, sans-serif; z-index: 1000; max-width: 300px;">
        <h3 style="margin: 0 0 10px 0;">Instructions AR Interactive</h3>
        <p style="margin: 5px 0;">1. Autorisez l'accès à la caméra</p>
        <p style="margin: 5px 0;">2. Pointez vers le marqueur Hiro</p>
        <p style="margin: 5px 0;">3. <strong>Cliquez/Tapez sur la boîte</strong></p>
        <p style="margin: 5px 0;">4. Observez les changements :</p>
        <ul style="margin: 5px 0; padding-left: 20px;">
            <li>Couleur change</li>
            <li>Vitesse de rotation alterne</li>
            <li>Taille alterne</li>
        </ul>
        <br>
        <p style="margin: 5px 0; font-size: 12px;">
            <strong>Marqueur Hiro :</strong><br>
            <a href="https://jeromeetienne.github.io/AR.js/data/images/HIRO.jpg" target="_blank" style="color: #4CC3D9;">Télécharger le marqueur</a>
        </p>
    </div>

    <!-- Script pour gérer les interactions -->
    <script>
        let clickCount = 0;
        const colors = ['#4CC3D9', '#EF2D5E', '#FFC65D', '#7BC8A4', '#FF6B6B', '#4ECDC4'];
        let isFastRotation = false;
        let isLargeScale = false;

        // Attendre que la scène soit chargée
        document.addEventListener('DOMContentLoaded', function() {
            // Attendre un peu plus pour que AR.js soit complètement initialisé
            setTimeout(function() {
                const box = document.querySelector('#interactiveBox');
                console.log('Box trouvée:', box);
                
                if (box) {
                    // Gestion des événements de clic/tap
                    box.addEventListener('click', function() {
                        console.log('Clic détecté sur la boîte!');
                        clickCount++;
                        
                        // Changement de couleur
                        const newColor = colors[clickCount % colors.length];
                        box.setAttribute('material', 'color', newColor);
                        
                        // Animation de pulsation au clic
                        box.setAttribute('animation__pulse', 
                            'property: scale; from: 1 1 1; to: 1.2 1.2 1.2; dur: 200; direction: alternate; loop: 2');
                        
                        // Alternance de la vitesse de rotation
                        isFastRotation = !isFastRotation;
                        const rotationSpeed = isFastRotation ? 500 : 2000;
                        box.setAttribute('animation__rotation', 
                            'property: rotation; to: 0 360 0; loop: true; dur: ' + rotationSpeed);
                        
                        // Alternance de l'échelle
                        isLargeScale = !isLargeScale;
                        const scale = isLargeScale ? '1.5 1.5 1.5' : '1 1 1';
                        box.setAttribute('animation__scale', 
                            'property: scale; to: ' + scale + '; dur: 500; easing: easeInOutQuad');
                        
                        console.log('Clic détecté! Couleur:', newColor, 'Rotation rapide:', isFastRotation, 'Grande taille:', isLargeScale);
                    });
                    
                    // Gestion des événements tactiles pour mobile
                    box.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        console.log('Touch détecté sur la boîte!');
                        box.click(); // Déclenche le même comportement que le clic
                    });
                } else {
                    console.log('Boîte non trouvée, réessai dans 2 secondes...');
                    setTimeout(function() {
                        const boxRetry = document.querySelector('#interactiveBox');
                        if (boxRetry) {
                            console.log('Boîte trouvée au deuxième essai!');
                        } else {
                            console.log('Boîte toujours non trouvée');
                        }
                    }, 2000);
                }
            }, 1000);
        });
    </script>
</body>
</html>
