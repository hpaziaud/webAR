<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP02 WebAR - Exercice 3 : Interactions par clic/tap</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene 
        embedded 
        arjs='sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;'
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
        
        <!-- Marqueur Hiro avec boîte interactive -->
        <a-marker preset="hiro" raycaster="objects: .clickable" emitevents="true" cursor="fuse: false; rayOrigin: mouse;">
            <a-box 
                id="interactiveBox"
                position="0 0.5 0" 
                material="color: #4CC3D9; opacity: 0.7; transparent: true;" 
                animation="property: rotation; to: 0 360 0; loop: true; dur: 2000;"
                class="clickable"
                cursor-listener>
            </a-box>
        </a-marker>
        
        <!-- Caméra AR avec curseur -->
        <a-entity camera>
            <a-cursor 
                id="cursor"
                raycaster="objects: .clickable"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat"
                animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                animation__mouseleave="property: scale; startEvents: mouseleave; to: 1 1 1; dur: 150"
                cursor="fuse: true; fuseTimeout: 1500">
            </a-cursor>
        </a-entity>
    </a-scene>

    <!-- Instructions pour l'utilisateur -->
    <div style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 15px; border-radius: 5px; font-family: Arial, sans-serif; z-index: 1000;">
        <h3 style="margin: 0 0 10px 0;">Instructions AR Interactive</h3>
        <p style="margin: 5px 0;">1. Autorisez l'accès à la caméra</p>
        <p style="margin: 5px 0;">2. Pointez vers le marqueur Hiro</p>
        <p style="margin: 5px 0;">3. Une boîte bleue apparaîtra et tournera</p>
        <p style="margin: 5px 0;">4. <strong>Cliquez/tapez sur la boîte</strong> pour :</p>
        <p style="margin: 5px 0; padding-left: 20px;">• Changer sa couleur</p>
        <p style="margin: 5px 0; padding-left: 20px;">• Accélérer la rotation</p>
        <p style="margin: 5px 0; padding-left: 20px;">• Changer sa taille</p>
        <br>
        <p style="margin: 5px 0; font-size: 12px;">
            <strong>Marqueur Hiro :</strong><br>
            <a href="https://jeromeetienne.github.io/AR.js/data/images/HIRO.jpg" target="_blank" style="color: #4CC3D9;">Télécharger le marqueur</a>
        </p>
    </div>

    <script>
        // Variables pour les couleurs et animations
        const colors = ['#4CC3D9', '#EF2D5E', '#FFC65D', '#7BC8A4', '#FF6B6B', '#4ECDC4'];
        let currentColorIndex = 0;
        let isFastRotation = false;
        let isScaled = false;

        // Fonction pour changer la couleur et l'animation de la boîte
        function changeBoxAppearance() {
            const box = document.getElementById('interactiveBox');
            
            // Changer la couleur
            currentColorIndex = (currentColorIndex + 1) % colors.length;
            box.setAttribute('material', `color: ${colors[currentColorIndex]}; opacity: 0.7; transparent: true;`);
            
            // Changer l'animation de rotation
            if (isFastRotation) {
                // Rotation normale
                box.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 2000;');
                isFastRotation = false;
            } else {
                // Rotation rapide
                box.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 500;');
                isFastRotation = true;
            }
            
            // Changer l'échelle
            if (isScaled) {
                // Taille normale
                box.setAttribute('scale', '1 1 1');
                isScaled = false;
            } else {
                // Taille agrandie
                box.setAttribute('scale', '1.5 1.5 1.5');
                isScaled = true;
            }
            
            // Animation de pulsation lors du clic
            box.setAttribute('animation__pulse', 'property: scale; from: 1 1 1; to: 1.2 1.2 1.2; dur: 200; direction: alternate; loop: 2;');
            
            // Supprimer l'animation de pulsation après 400ms
            setTimeout(() => {
                box.removeAttribute('animation__pulse');
            }, 400);
        }

        // Écouter les événements de clic sur la boîte
        document.addEventListener('DOMContentLoaded', function() {
            const box = document.getElementById('interactiveBox');
            
            // Événement pour desktop (souris)
            box.addEventListener('click', changeBoxAppearance);
            
            // Événement pour mobile (touch)
            box.addEventListener('touchstart', function(e) {
                e.preventDefault();
                changeBoxAppearance();
            });
        });
    </script>
</body>
</html>
